<!DOCTYPE html>

<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ChatNet</title>
    <link rel="stylesheet" href="./chatRoom.css">
    <script src="/socket.io/socket.io.js"></script>
  <script src="https://code.jquery.com/jquery-3.6.0.min.js%22%3E"></script>
</head>
<body>
    <!-- Top of ChatRoom  -->
    <div class="topContainer">

        <div class="backIcon">
          <svg id="Layer_2" data-name="Layer 2" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 59.44 59.77" width="100%" height="100%">
            <g id="Layer_1-2" data-name="Layer 1">
              <path d="M56.72,43.55l-11.6-13.3c-.09-.09-.18-.15-.09-.25l8.7-10.24c3.85-4.13,7.94-11.23,3.47-16.34-.32-.37-.64-.7-.97-1-4-3.7-8.46-2.72-13.9-.02L5.43,22.31C1.97,24.18-.11,27.79,0,31.73c.12,3.94,2.41,7.41,5.99,9.07l38.65,17.94c.3,.14,.6,.26,.9,.37,3.06,1.11,6.27,.79,9.03-.91,3.27-2.01,5.16-5.71,4.83-9.79-.22-2.68-.79-2.96-2.69-4.87Zm-2.54,5.37c.12,2.08-.75,3.83-2.35,4.81-1.37,.84-2.96,1-4.48,.45-.17-.06-.33-.13-.49-.2L8.2,36.04c-1.78-.83-2.89-2.5-2.95-4.47s.94-3.7,2.67-4.64L44.74,7.07c5.77-2.85,6.94-1.98,8.5-.18,1.91,2.18-.78,7.41-3.37,10.19,0,0-5.56,6.64-8.64,10.35-1.16,1.4-1.14,3.43,.04,4.81l11.15,12.97c.99,1,1.67,2.3,1.75,3.7Z"/>
            </g>
          </svg>        
        </div>

        <div class="groupChat">
            <div class="image">
                <img class="backIconImage" src="./Assets/JPG/profile.jpg" alt="group chat image" width="52px" >
            </div>
            <div>
              <div class="chatName"><h2>Designers!</h2></div>  
              <div class="members"><p>20 members</p></div>  
            </div>
        </div>

        <div class="time"></div>
    </div>

    <!--  Chat  -->
    <div class="chatContainer">
      
        <script>
          const socket = io();

document.getElementById("chat-form").addEventListener("submit", function (e) {
  e.preventDefault(); // prevents page reloading
  const message = document.getElementById("m").value.toString(); // Convert the value to string
  socket.emit("chat message", message);
  document.getElementById("m").value = "";
});

socket.on("chat message", function (data) {
  const li = document.createElement("li");
  const span = document.createElement("span"); // Create a <span> element to hold the username
  span.textContent = data.username + ": "; // Set the text content of the <span> element to the username
  li.appendChild(span); // Append the <span> element to the <li> element
  li.textContent += data.message; // Append the message to the <li> element
  document.getElementById("messages").appendChild(li);
});

document.getElementById("login-form").addEventListener("submit", function (e) {
  e.preventDefault(); // prevents page reloading
  const username = document.getElementById("username").value;
  const password = document.getElementById("password").value;
  document.getElementById("username").value = "";
  document.getElementById("password").value = "";
  socket.emit("login", { username, password });
});

// Listen for bot mentions and pass the user's prompt to the OpenAI API
socket.on("bot mention", function (data) {
  const xhr = new XMLHttpRequest();
  xhr.open("POST", "/api/openai");
  xhr.setRequestHeader("Content-Type", "application/json");
  xhr.onload = function () {
    if (xhr.status === 200) {
      socket.emit("chat message", JSON.parse(xhr.responseText).message);
    }
  };
  xhr.send(JSON.stringify({ prompt: data.msg }));
});
        </script>
    </div>

    
    
    <!--  MessageBox  -->
    <div class="messageContainer">
        <!-- <div class="messageBox"> -->
            <div class="messages">
            <form id="chat-form" action="">
              <input id="m" autocomplete="off"> 
            </div>
            <div class="sendIcon">
              <a href="">
              <svg id="Layer_2" data-name="Layer 2" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 76.69 78.48" width="30" height="30">
                <defs>
                  <style>
                    .cls-1 {
                      fill: #000000;
                    }
                  </style>
                </defs>
                <g id="Layer_1-2" data-name="Layer 1">
                  <g id="Layer_1-2" data-name="Layer 1-2">
                    <path class="cls-1" d="M46.33,78.46c-.55,0-1.12-.02-1.74-.1-8.43-.89-11.47-11.69-11.46-18.74l.04-16.24-20.18-.82c-4.14-.16-8.06-2.27-10.5-5.62C.16,33.72-.58,29.71,.46,25.94c1.09-3.91,3.75-6.92,7.5-8.5,.36-.15,.75-.3,1.15-.42L59.78,.63c4.69-1.51,9.75-.27,13.19,3.24,3.45,3.51,4.61,8.58,3.02,13.24l-16.91,49.58c-2.71,7.1-5.96,11.78-12.76,11.78h0Zm-6.57-36.82l-.05,17.98c0,4.75,1.97,11.82,5.57,12.19,2.96,.31,4.77,.12,7.63-7.4L69.78,14.99c.8-2.32,.24-4.76-1.49-6.52s-4.16-2.35-6.5-1.59h0L11.14,23.26c-.21,.06-.41,.15-.62,.24-1.86,.79-3.19,2.29-3.72,4.22-.51,1.85-.15,3.76,1.02,5.37,1.27,1.75,3.31,2.84,5.46,2.92l21.97,.89,12.77-11.96c1.32-1.24,3.4-1.17,4.64,.15,.59,.64,.89,1.44,.89,2.24,0,.87-.35,1.75-1.04,2.4l-12.74,11.93h.01Z"/>
                  </g>
                </g>
              </svg>
            </a>
            </div>

        <!-- </div> -->
    </div>
   
</body>
</html>